\subsection{Proof Of Relay}

HOPR incentivizes packet transformation and delivery using a mechanism called “Proof-Of-Relay”.
This mechanism guarantees that nodes relay services are verifiable.
\paragraph{Construction}
\begin{itemize}
    \item Every packet is sent together with a ticket (check ticket section).
    \item Each ticket contains a challenge.
    \item The validity of a ticket can only be checked on reception of the packet but the on-chain logic enforces a solution to the challenge stated in the ticket (check ticket section).
\end{itemize}

\subsubsection{Challenge}
$(A)$ creates a shared secret $s_i$ with all the relay nodes in the channel (B-C-D-Z) by using an offline version of the Diffie-Hellman key exchange. This shared key is a session key that's generated from the master DH key sphinx key.
    \\~\\ The shared secret $s_i$ is used as a seed for a PRG (Pseudo Random Generator) to create secret shares $s_i^{(0)},s_i^{(1)}$ for each node along the route.
    Relayers compute $s_i^{(0)}$ and get $s_{i+1}^{(1)}$ from the next downstream node.
    \newline The sender $(A)$ provides a hint to the expected value $s_{i+1}^{(1)}$ that a node $n_i$ is expected to get from the next downstream node.
    The value “hint” or $H$ is computed as 
    \begin{align}  
        H_i&=s_{i+1}^{(1)}*G
         \end{align}
    where $*$ is the curve multiplication operation and $G$ is a generator of the curve (the same used in the sphinx section). 
    \newline The hint for party $n_i$ is used to check whether the returned value $s_{i+1}'^{(1)}$ matches the promised value $s_{i+1}^{(1)}$ by checking whether $hint_i$ equals $s_{i+1}'^{(1)}*G$. 
   \\The sender $(A)$ also creates a challenge $T_{c_i}$ such that 
   \begin{align}  
    T_{c_i}&=(s_i^{(0)}+s_{i+1}^{(1)})*G
     \end{align}
   Since “Proof-Of-Relay” is used to make the relay services of nodes verifiable, it is the duty of each node to check that given challenges are derivable from the given and the expected information.
Packets with inappropriate challenges should be dropped as they might not lead to winning tickets.
\begin{comment}
 \begin{figure}[H]
    \centering
    \begin{tabular}{| m{2em} | m{15em} | m{2em} |}
        \hline
        $\alpha$ & $\beta$                   & $\gamma$ \\
                 & \begin{tabular}{| c m{2em} | m{3em} | m{6em} |}
            \hline
            \multicolumn{2}{| c |}{$Y_B$} & $hint_B$                 & $challenge_{BC}$ \\
            \hline
            \multicolumn{2}{| c |}{$Y_C$} & $hint_C$                 & $random$         \\
            \hline
            \multicolumn{2}{| c |}{$Y_D$} & $hint_D$                 & $random$         \\
            \hline
            End                           & \multicolumn{3}{| l |}{}                    \\
            \hline
        \end{tabular} &          \\[3em]
        \hline
    \end{tabular}
    \caption{SPHINX with PoR}
    \label{fig:SPHINX with PoR}
\end{figure}
\end{comment}